# IFC to Graph + Neo4j Integration
This script demonstrates how to:

**Load an IFC model** using ifcopenshell.

**Build a graph of IFC elements** and their bounding volumes.

**Compute a BVH (Bounding Volume Hierarchy)** for efficient spatial queries.

**Identify “near” elements** based on overlapping bounding volumes.

**Push the resulting graph (nodes and relationships) into a Neo4j database.**

Prerequisites
Python 3.7+ (or a recent version).

2. Install ifcopenshell – for reading/parsing IFC files.
Install via:
```
bash
Kopieren
Bearbeiten
pip install ifcopenshell
```
3.**Neo4j** – installed locally or accessible remotely.

Defaults to _bolt://localhost:7687_

Download Neo4j here.[Neo4j]([url](https://neo4j.com/download/))

4.Neo4j Python driver – for connecting from Python to Neo4j.
```
bash
Kopieren
Bearbeiten
pip install neo4j
```
5.A file named var.py containing your Neo4j username and password, for example:

python
Kopieren
Bearbeiten
### var.py
user_name = "neo4j"
password = "yourpassword"
How It Works
Open an IFC file:
The script loads test1.ifc (default path: data/ifc/test1.ifc) with:
```
python
Kopieren
Bearbeiten
model = ifcopenshell.open(file_path)
```
### Create a Graph:

Graph.create(root) traverses the IFC structure, instantiating a Node object for each element.

Each node includes data such as guid, geom_info (bounding boxes, transforms), and property sets.

### Build BVH:

graph.build_bvh() constructs a bounding volume hierarchy for all elements, speeding up overlap checks.

### Near Relationships:

For each node, the code uses graph.bvh_query(node.geom_info["bbox"]) to find other bounding boxes that intersect.

Each node’s near list is populated with these neighboring nodes.

### Push to Neo4j:

A driver is created via create_driver(...), connecting to the Neo4j server (default bolt://localhost:7687).

push_graph_to_neo4j(driver, graph.node_dict) inserts each node and relationship into the graph database:

Nodes are labeled (e.g. :IfcElement, or dynamically by node.geom_type).

Overlapping elements become connected via a [:NEAR] relationship.

Usage
Install dependencies:

bash
Kopieren
Bearbeiten
pip install ifcopenshell neo4j
Ensure Neo4j is running:

By default, it listens on bolt://localhost:7687.

Username/password may be neo4j / neo4j initially.
Change them or keep them as needed.

**Edit var.py:
**
```
python
Kopieren
Bearbeiten
# var.py
user_name = "neo4j"
password = "mysecretpassword"
```

**Run the script (example: main.py):
**
```
bash
Kopieren
Bearbeiten
python main.py
```
**Inspect results in Neo4j Browser:
**
Open http://localhost:7474
```
Query:

cypher
Kopieren
Bearbeiten
MATCH (n) RETURN n LIMIT 25
or altenraitvely
MATCH (n) RETURN n
```
You should see newly inserted IFC elements and their relationships.

Optionally 
**RAG with Openai**
You can also set your openai api key to use the rag that helps generate Cypher queries for the graph DB
```
text_query = "Return all the nodes with the name 'HÜLLKÖRPER' and their relationships"
cypher_query = generate_cypher_query(text_query, api_key = var.openai_api_key, model = "gpt-4o-mini")
```
Use the cypher query generated by the ai model instead !!! :)

